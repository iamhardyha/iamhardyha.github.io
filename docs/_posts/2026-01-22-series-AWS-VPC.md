---
layout: post
title: "[AWS 시리즈] VPC 관련 서비스를 알아보자"
date: 2026-01-22
categories: [infra]
tags: [AWS, VPC, NACL, SUBNET, 보안그룹]
thumbnail: "/assets/img/awsvpc.png"
---


# AWS VPC 완전 정복: 개발자·비개발자 모두를 위한 직관적인 설명

AWS에서 서비스를 제대로, 그리고 안전하게 운영하려면 **VPC를 이해하는 것**이 사실상 출발점입니다.
이 글에서는 공식 문서와 여러 자료를 바탕으로 **개발자와 비개발자 모두 이해할 수 있도록** 풀어서 정리했습니다.
* VPC가 왜 생겼는지, 기본 개념부터 퍼블릭/프라이빗 서브넷, 라우팅, 인터넷 게이트웨이, NAT, 보안그룹과 NACL까지 단계적으로 정리할 거예요. 마지막에는 "VPC가 없었을 때의 문제"를 일상적인 비유로 다시 정리해, 독자분들이 쉽게 공감할 수 있도록 구성했습니다.

---

## 1. VPC란 무엇인가? — "클라우드 속 나만의 데이터센터"

### 1.1 정의: 논리적으로 격리된 가상 네트워크

**VPC(Amazon Virtual Private Cloud)**는 AWS 클라우드 안에서 **내 계정 전용으로 논리적으로 분리된 가상 네트워크**입니다.  
쉽게 말해, **AWS 데이터센터 안에 내 회사만 쓰는 전용 네트워크 구역을 하나 파서 쓰는 것**입니다.

- AWS는 전 세계에 거대한 데이터센터(물리 서버 집합)를 가지고 있음
- 그 위에 수많은 고객(회사, 개인)이 **같은 물리 인프라를 공유**해서 사용
- 이때 **서로의 네트워크가 섞이지 않도록** 논리적으로 분리해주는 게 VPC

AWS 공식 정의로는:

> "VPC는 사용자가 정의한 논리적으로 격리된 가상 네트워크로, 자신의 데이터센터에서 운영하는 전통적인 네트워크와 매우 유사하게 구성할 수 있다."

### 1.2 VPC가 도입되기 전에는 어땠을까?

2011년 이전 초기 AWS 환경에서는 네트워크 격리 개념이 지금처럼 명확하지 않았고, 여러 고객의 인스턴스가 **같은 평면(network plane)** 위에 뒤섞여 있는 구조에 가까웠습니다. 지금처럼 **계정별, VPC별로 네트워크를 세밀하게 설계하고, 온프레미스처럼 라우팅·보안 정책을 제어하는 모델은 아니었**습니다.

VPC가 도입되면서:

- 각 고객이 **자신만의 IP 대역, 서브넷, 라우팅, 방화벽 정책을 설계**할 수 있게 되었고
- 마치 **내가 직접 IDC(데이터센터)에 네트워크를 깔고 운영하는 것과 비슷한 수준의 통제권**을 가지게 되었습니다.

지금은 **모든 EC2, RDS 등 주요 서비스가 반드시 VPC 안에서 동작**하며, 계정 생성 시 **각 리전에 기본 VPC(default VPC)가 자동으로 생성**됩니다.

---

## 2. 리전, AZ, VPC, 서브넷의 관계

### 2.1 리전(Region)과 가용 영역(AZ)

- **리전(Region)**: 물리적인 데이터센터 집합이 위치한 **지리적 영역** (예: ap-northeast-2, us-east-1).
- **AZ(Availability Zone)**: 한 리전 안에 있는 **서로 분리된 데이터센터 그룹**.  
  보통 하나의 리전에는 2개 이상의 AZ가 존재하며, 각 AZ는 **독립 전력·네트워크**를 가지도록 설계되어 장애 격리가 가능합니다.

리전과 AZ를 한 줄로 요약하면:

> "리전은 도시(서울), AZ는 도시 안의 서로 떨어진 전기·통신이 분리된 건물군."

### 2.2 VPC는 리전 단위 네트워크

**VPC는 특정 리전에 종속되는 네트워크 단위**입니다.

- 하나의 VPC는 **하나의 리전 안에만 존재**합니다.  
  (리전을 가로질러 확장하는 VPC는 만들 수 없음)
- 대신, **한 리전 안에서 여러 개의 VPC를 만들 수는 있음**

각 VPC는 **자신만의 IP 주소 대역(CIDR)**을 할당받습니다.

- IPv4의 경우 일반적으로 **사설 IP (RFC1918: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)** 대역을 사용
- 예: `10.0.0.0/16`, `172.31.0.0/16` 등

여기서 중요한 제약:

- **같은 리전 내에서 VPC 간 CIDR이 겹치면 안 됨**  
  이유: 나중에 VPC 피어링, Transit Gateway 등으로 VPC 간 통신을 구성할 때 **IP가 겹치면 라우팅 불가**.

또한 **한 번 생성한 VPC의 CIDR 블록은 일부 상황을 제외하면 변경이 어렵거나 제한적**이므로, 애초에 설계 시 신중하게 잡는 것이 중요합니다.

---

## 3. 기본 VPC(Default VPC)와 직접 만든 VPC

### 3.1 기본 VPC란?

AWS 계정을 처음 만들면, 각 리전에 **기본 VPC(Default VPC)**가 자동으로 생성됩니다.

기본 VPC는 다음 구성 요소를 자동으로 제공합니다.

- 리전별로 하나의 **VPC (예: 172.31.0.0/16)**
- 각 AZ마다 하나씩의 **기본 서브넷(보통 퍼블릭 성격)**
- VPC와 연결된 **Internet Gateway (IGW)**
- **라우팅 테이블**: `172.31.0.0/16 → local`, `0.0.0.0/0 → IGW` 기본 경로
- **기본 Security Group, 기본 Network ACL, 기본 DHCP 옵션**

그래서, 아무것도 몰라도:

- 그냥 EC2 생성 → **자동으로 기본 VPC의 퍼블릭 서브넷에 배치**
- 퍼블릭 IP까지 자동 할당 → 곧바로 인터넷 접속 가능

초보자에게는 매우 편하지만, **모든 인스턴스가 기본적으로 외부에 노출되는 구조**라 보안 측면에서 권고되는 패턴은 아닙니다.

### 3.2 기본 VPC vs 커스텀 VPC

운영 환경에서는 보통:

- 기본 VPC는 **삭제하거나 거의 사용하지 않고**,
- **직접 설계한 VPC(커스텀 VPC)**를 만들어서 **퍼블릭/프라이빗 서브넷, 라우팅, NAT, 보안그룹, NACL 등을 명시적으로 구성**하는 것이 일반적입니다.

---

## 4. 서브넷(Subnet): VPC 안의 "방 나누기"

### 4.1 서브넷의 역할과 범위

**서브넷(Subnet)**은 VPC의 IP 대역을 잘게 쪼갠 **논리적/물리적 네트워크 구역**입니다.

- VPC가 "전체 아파트 단지"라면, **서브넷은 동/라인 단위 구역**에 가깝습니다.
- EC2, RDS 등 **실제 리소스는 반드시 서브넷 안에 생성**됩니다.
- 서브넷은 **단 하나의 AZ에만 소속**될 수 있습니다.  
  (하나의 서브넷을 여러 AZ에 걸쳐 만들 수 없음)

CIDR 측면에서:

- VPC CIDR 예: `10.0.0.0/16`
- 그 안에서 서브넷 예:
    - `10.0.1.0/24` (AZ a, 퍼블릭)
    - `10.0.2.0/24` (AZ a, 프라이빗)
    - `10.0.3.0/24` (AZ c, 퍼블릭)
    - `10.0.4.0/24` (AZ c, 프라이빗)

**서브넷 CIDR은 반드시 VPC CIDR 안에 포함되어야 하고**, VPC 내 다른 서브넷과 **서로 겹치면 안 됩니다**.

### 4.2 AWS가 예약하는 IP 주소

각 서브넷 안에는 **AWS가 내부적으로 사용하는 예약 IP 5개**가 있습니다.

예를 들어 `10.0.1.0/24` 서브넷이면:

- `10.0.1.0`: 네트워크 주소
- `10.0.1.1`: VPC 라우터
- `10.0.1.2`: AWS에서 사용하는 DNS 등용
- `10.0.1.3`: 향후 확장용 예약
- `10.0.1.255`: 브로드캐스트 주소 (AWS는 L3 네트워크여서 브로드캐스트를 사용하지 않지만 예약)

즉, **총 IP 개수에서 5개를 뺀 값만 실제로 EC2 등에서 사용 가능**합니다.

---

## 5. 퍼블릭 서브넷 vs 프라이빗 서브넷

### 5.1 퍼블릭 서브넷(Public Subnet)의 조건

AWS에서 "퍼블릭 서브넷"이라는 말은 **단순히 이름이 아니라, 네트워크 구성 조건**으로 정의됩니다.

**어떤 서브넷이 퍼블릭 서브넷으로 간주되려면:**

1. 그 서브넷에 속한 인스턴스(예: EC2)가 **퍼블릭 IP(또는 Elastic IP)를 보유**하고
2. 해당 서브넷이 연관된 **라우팅 테이블에 `0.0.0.0/0 → Internet Gateway` 경로가 존재**해야 합니다.

이 두 조건을 만족하면:

- 외부 인터넷 → 퍼블릭 IP → IGW → 서브넷 → 인스턴스 인바운드 가능
- 인스턴스 → IGW → 인터넷으로 아웃바운드 가능

주로 이런 용도로 사용합니다.

- 웹 서버, API 서버 등 **인터넷에서 직접 접근해야 하는 리소스**
- Bastion Host (프라이빗 서브넷에 SSH/RDP 접속용)

퍼블릭 서브넷 CIDR은 보통 **상대적으로 많은 IP가 필요**하므로 `/24` 등 비교적 낮은 prefix(큰 대역)를 잡는 경우가 많습니다.

### 5.2 프라이빗 서브넷(Private Subnet)의 조건

반대로, **프라이빗 서브넷**은:

- **직접 IGW로 나가는 경로(0.0.0.0/0 → IGW)가 라우팅 테이블에 없고**
- 서브넷 내 인스턴스에 **퍼블릭 IP를 부여하지 않는** 서브넷을 의미합니다.

이 경우:

- 외부에서 **직접 인바운드 접근 불가**
- 서브넷 내 인스턴스들도 **직접 인터넷으로 나갈 수 없음**

하지만 다음은 가능합니다.

- 같은 VPC 내 퍼블릭 서브넷/다른 프라이빗 서브넷과의 **사설 IP 기반 통신(local route)**
- **NAT Gateway/NAT Instance**를 통해 간접적으로 인터넷 아웃바운드(업데이트, 패키지 설치 등)

프라이빗 서브넷은 주로:

- **DB(RDS), 캐시(ElastiCache), 내부 백엔드 서비스, 민감 정보 처리 시스템** 등을 배치해 **보안 레벨을 높이는 용도**로 사용합니다.

CIDR은 보통 **적은 수의 인스턴스만 필요**하므로 `/26`, `/27` 등 상대적으로 좁게 설계하는 경우가 많습니다.

### 5.3 퍼블릭/프라이빗 서브넷, AZ 배치 전략

질문을 하신 분들이 많이 궁금해하는 부분입니다:

> "퍼블릭 서브넷과 프라이빗 서브넷을 각기 다른 AZ에 설정해도 될까?"

- 기술적으로 **문제 없습니다.** VPC 내부 통신은 AZ를 가로질러도 가능하며, 라우팅도 자동으로 구성됩니다.
- 다만, 같은 AZ 안에서 퍼블릭/프라이빗을 짝으로 두면:
    - 해당 AZ 내 통신 레이턴시가 더 낮고
    - 장애 시, **AZ 단위로 페일오버 전략을 세우기 쉽습니다**.

실무에서는 보통:

- AZ A: Public Subnet A, Private Subnet A
- AZ C: Public Subnet C, Private Subnet C

이런 식으로 **멀티 AZ + 퍼블릭/프라이빗 페어 구조**로 설계합니다.

---

## 6. 라우팅 테이블과 VPC 라우터

### 6.1 기본 개념

**라우팅 테이블(Route Table)**은 "이 목적지 IP 대역으로 가는 트래픽은 어디로 보내야 하는지"를 정의한 규칙 집합입니다.

각 서브넷은 **반드시 하나의 라우팅 테이블과 연관**되며:

- 서브넷 내 인스턴스가 패킷을 보낼 때 → 해당 서브넷의 라우팅 테이블을 보고 **VPC 라우터가 경로를 결정**합니다.

기본적으로 생성되는 엔트리:

- `VPC_CIDR → local`  
  예: `10.0.0.0/16 → local`  
  → VPC 내부 서브넷 간 통신은 별도 설정 없이 자동 가능

여기에 추가로:

- 퍼블릭 서브넷용 테이블:
    - `0.0.0.0/0 → Internet Gateway`
- 프라이빗 서브넷용 테이블:
    - `0.0.0.0/0 → NAT Gateway`

### 6.2 퍼블릭 서브넷 예시

퍼블릭용 라우팅 테이블:

- `10.0.0.0/16 → local`
- `0.0.0.0/0 → igw-xxxx`

이 테이블과 연결된 서브넷은 **인터넷 게이트웨이를 통해 외부와 양방향 통신**할 수 있으므로 퍼블릭 서브넷이 됩니다.

### 6.3 프라이빗 서브넷 + NAT 구조

프라이빗 서브넷은 보통:

- `10.0.0.0/16 → local`
- `0.0.0.0/0 → nat-xxxx`

NAT Gateway는 **Public Subnet에 위치**하며, Elastic IP(공인 IP)를 가지므로:

- Private Subnet 인스턴스 → NAT Gateway → IGW → 인터넷 (아웃바운드만)
- 외부에서 직접 Private Subnet 인스턴스로는 들어올 수 없음

---

## 7. 인터넷 게이트웨이(IGW): VPC의 "정문"

### 7.1 IGW의 역할

**Internet Gateway(IGW)**는 VPC 안의 리소스와 인터넷 간의 통신을 가능하게 해주는 **논리적 게이트웨이**입니다.

특징:

- 하나의 VPC에 **하나의 IGW만 연결**할 수 있음
- IGW 자체는 고가용성이며 리전 내에서 수평 확장됨
- 퍼블릭 IP를 가진 리소스가 IGW를 통해 인터넷과 통신

VPC 리소스가 인터넷과 통신하려면:

1. **퍼블릭 IP(또는 Elastic IP)를 보유**해야 하고
2. 소속 서브넷의 라우팅 테이블에 **`0.0.0.0/0 → IGW` 경로가 있어야 하며**
3. **Security Group, NACL에서 해당 트래픽을 허용**해야 합니다.

---

## 8. NAT Gateway / NAT Instance: 프라이빗 서브넷의 아웃바운드 통로

### 8.1 NAT가 필요한 이유

프라이빗 서브넷에 있는 인스턴스(예: RDS, 내부 EC2)는:

- 직접 인터넷에 노출되면 안 되지만
- OS 업데이트, 패키지 설치, 외부 API 호출 등 **아웃바운드 인터넷 접속은 필요한 경우**가 많습니다.

이때 사용하는 것이 **NAT(Network Address Translation)**입니다.

### 8.2 NAT Gateway

**NAT Gateway**는 AWS가 제공하는 관리형 NAT 서비스입니다.

특징:

- **Public Subnet에 위치**하며, Elastic IP를 통해 인터넷과 통신
- Private Subnet의 라우팅 테이블에서 `0.0.0.0/0 → NAT Gateway`로 설정
- 고가용성과 확장성이 AWS에서 관리, 운영 환경에서는 **NAT Gateway 사용이 권장**

### 8.3 NAT Instance

예전 방식으로, 단일 EC2를 세워서 NAT 역할을 하게 하는 방법입니다.

- 요즘은 **관리 비용·장애 포인트 때문에 비권장**
- 특정 커스텀 동작이 필요한 특수 케이스가 아니면 NAT Gateway 사용을 추천

---

## 9. VPC 보안: Security Group vs Network ACL

VPC에는 **두 단계의 네트워크 방화벽 계층**이 있습니다.

1. **Security Group (SG)**: 인스턴스 단위 방화벽 (Stateful)
2. **Network ACL (NACL)**: 서브넷 단위 방화벽 (Stateless)

### 9.1 Security Group: 인스턴스 레벨, Stateful 방화벽

**Security Group**은 EC2, RDS, ENI, 로드밸런서 등 **리소스 단위에 붙는 가상 방화벽**입니다.

특징:

- **인바운드 규칙, 아웃바운드 규칙**으로 나뉨
- **Allow(허용) 규칙만 존재**, Deny는 없음
- 기본 아웃바운드는 "모두 허용"으로 생성되지만 변경 가능
- 하나의 인스턴스에 **여러 개 SG를 동시에 할당 가능**
- 가장 중요한 특징: **Stateful**
    - 인바운드에서 허용된 트래픽의 **응답 패킷은 아웃바운드 규칙에 상관없이 자동 허용**
    - 반대로 아웃바운드에서 나간 연결의 응답도 인바운드 규칙에 상관없이 허용

예를 들어:

- 인바운드: 80/tcp, 443/tcp, 22/tcp 허용
- 아웃바운드: 모든 트래픽 허용 또는 심지어 None(허용 없음)으로 설정해도
- 80, 443, 22로 들어온 트래픽의 **응답은 SG가 상태를 기억하고 자동 허용**합니다.

즉, SG는 **"연결을 기준으로 상태를 기억하는 Stateful 방화벽"**입니다.

### 9.2 Network ACL: 서브넷 레벨, Stateless 방화벽

**Network ACL(NACL)**은 서브넷 레벨에서 동작하는 방화벽입니다.

특징:

- **서브넷에 연결**, 하나의 서브넷은 정확히 **하나의 NACL만 사용 가능**
- 여러 서브넷이 **같은 NACL을 공유**할 수는 있음
- 인바운드 규칙, 아웃바운드 규칙을 모두 가짐
- **Allow와 Deny 둘 다 설정 가능** → 특정 IP 차단(블랙리스트)에 유용
- 가장 중요한 특징: **Stateless**
    - 인바운드 규칙과 아웃바운드 규칙을 **각각 별도로 모두 맞춰야 함**
    - 인바운드에서 허용되었다고 해서 응답이 자동 허용되지 않음
- **규칙에는 번호(우선순위)가 있고, 작은 번호부터 순차적으로 평가**

정리하면:

> SG는 "인스턴스에 붙는, 상태를 기억하는 허용 전용 방화벽",  
> NACL은 "서브넷 앞단에서, 허용·차단을 모두 다루는 Stateless 필터"입니다.

### 9.3 SG와 NACL 조합 전략

AWS 권장 패턴은 다음과 같습니다.

- **NACL**: 기본은 넉넉하게 허용하되,
    - 특정 악성 IP/대역을 **명시적으로 차단(Deny)** 하는 레이어
- **Security Group**: 각 인스턴스/서비스 특성에 맞게
    - 필요한 포트/프로토콜/IP만 **최소 권한으로 허용**

즉:

1. NACL에서 "큰 틀의 엣지 필터링"
2. SG에서 "서비스 별 세밀한 포트/프로토콜 제어"

이렇게 **Defense in Depth(다중 방어층)** 전략을 구성하는 것이 일반적입니다.

---

## 10. VPC가 왜 꼭 필요할까? — 비유로 다시 정리

### 10.1 VPC가 있는 세상: 아파트 단지 + 집 + 현관문

- **AWS 전체 클라우드**: 거대한 아파트 단지
- **VPC**: 아파트 단지 안의 **각 세대(집)**  
  → **벽으로 구분된 독립된 공간**
- **서브넷**: 집 안의 방 구분 (거실, 안방, 금고방 등)
    - 퍼블릭 서브넷: 거실 (손님 초대, 외부 노출 가능)
    - 프라이빗 서브넷: 금고방 (가족/내부 시스템만 접근)
- **Security Group**: 각 방(인스턴스) 출입문에 붙어있는 **인터폰/도어락**  
  → "누가, 어떤 용도로, 어느 포트(문)로 들어올 수 있는지"를 제어
- **NACL**: 아파트 복도 입구에 있는 **경비 아저씨**  
  → 층/라인 전체에 대한 출입 차단 규칙
- **Internet Gateway**: 아파트 단지의 **정문**  
  → 퍼블릭 서브넷에 있는 집(퍼블릭 IP 보유 인스턴스)이 밖으로 나가거나 밖에서 들어오는 통로
- **NAT Gateway**: 금고방에 있는 사람이 **정문으로 직접 나가지는 못하지만, 집 사람(대리인)을 통해 택배를 시키는 것**  
  → 프라이빗 서브넷 인스턴스가 업데이트 등을 위해 외부로 **아웃바운드만** 나갈 수 있게 해주는 통로

### 10.2 VPC가 없던 세상: 벽 없는 운동장

만약 VPC 개념이 없다면:

- 아파트 단지 전체가 **벽도 없는 거대한 운동장**이고
- 서로 다른 회사/고객의 서버들이 **한 공간에 아무 구분 없이 줄지어 놓여 있는 꼴**이 됩니다.
- 이 말은:
    - **다른 사람 방과 내 방 사이에 벽이 없다**
    - 누가 어느 쪽에서 패킷을 던져도, 어디로 갈지 명확하게 격리되지 않는다
    - 방화벽을 인스턴스마다 세밀하게 구성하기 어려워지고, **대규모 멀티테넌트 환경에서 보안 사고 리스크가 커진다**는 의미입니다.

그래서 AWS는 **각 고객 계정별로 VPC라는 논리적 데이터센터를 강제**하고, 그 안에서만 리소스를 배치하도록 한 것입니다.

---

## 결론: 클라우드 속 나만의 네트워크 데이터센터

VPC는 단순한 네트워킹 기능이 아니라, **AWS에서 보안과 격리를 보장하는 가장 기본적인 단위**입니다.

VPC를 제대로 설계한다는 것은:

1. **리전과 AZ를 고려한 가용성 설계**
2. **퍼블릭/프라이빗 서브넷 분리로 보안 강화**
3. **라우팅 테이블로 트래픽 흐름 제어**
4. **IGW, NAT를 통한 인터넷 연결성 확보**
5. **Security Group + NACL로 다층 방어**

이 모든 것을 담아내는 일입니다. 처음에는 복잡해 보이지만, 아파트 단지에서 각 세대의 네트워크를 관리하는 것처럼 생각하면, VPC의 구조와 필요성이 자연스럽게 이해될 것입니다.

앞으로 AWS를 사용하실 때, VPC 설계에 충분한 시간과 고민을 들이세요. 그것이 안정적이고 확장 가능한 클라우드 아키텍처의 첫 단계입니다! 🚀

---

## 참고 자료

- [AWS VPC 공식 페이지](https://aws.amazon.com/vpc/)
- [AWS VPC 공식 문서 - What is Amazon VPC?](https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html)
- [AWS VPC 기본 VPC 문서](https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc.html)
- [AWS VPC 기본 VPC 구성 요소](https://docs.aws.amazon.com/vpc/latest/userguide/default-vpc-components.html)
- [AWS Network ACL 공식 문서](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html)
- [K21Academy - AWS VPC 설명](https://k21academy.com/aws-cloud/aws-vpc-virtual-private-cloud/)
- [K21Academy - AWS Security Group vs NACL](https://k21academy.com/aws-cloud/aws-security-groups-vs-nacl/)
- [AWS 보안: 기본 VPC 설명](https://cybr.com/courses/introduction-to-aws-security/lessons/default-vpcs/)
