---
layout: post
title: "[AWS 시리즈] AWS VPC 엔드포인트 완벽 이해 (1) – 개념, 동작 원리, ENI, NAT 게이트웨이"
date: 2026-01-23
categories: [infra]
tags: [AWS, VPC, ENI, NAT]
thumbnail: "/assets/img/awsvpc2.png"
---

## 1. VPC와 ENI부터 짚고 가기

AWS VPC(Virtual Private Cloud)는 AWS 위에 올리는 **나만의 사설 네트워크 공간**이다.
CIDR 블록(예: 10.0.0.0/16)을 정해주면, 그 안에서 퍼블릭/프라이빗 서브넷을 나누고 EC2, RDS 같은 리소스를 배치하게 된다.

VPC 안에서 인스턴스가 네트워크에 붙기 위해 사용하는 것이 **ENI(Elastic Network Interface)**이다.
ENI는 가상의 네트워크 카드처럼 동작하며, 다음과 같은 속성을 가진다.

- 프라이빗 IP 주소(필수)
- 퍼블릭 IP 또는 Elastic IP(선택)
- 보안 그룹(Security Group)
- MAC 주소, 네트워크 통계 등

즉, EC2 인스턴스는 ENI를 통해 VPC 네트워크에 연결되고, 이 ENI에 사설/공인 IP가 매달린다고 이해하면 편하다.

---

## 2. S3, CloudWatch 같은 AWS 서비스들은 어디에 있을까?

EC2, RDS는 VPC 안에 직접 띄우지만, S3, CloudWatch, CloudFront, API Gateway 같은 서비스들은 **내 VPC 안에 설치되는 형태가 아니다.**
이 서비스들은 내가 선택한 리전에 존재하긴 하지만, AWS가 관리하는 별도의 네트워크 공간에 있고 보통 공인 IP를 통해 접근한다.

그래서 프라이빗 서브넷의 EC2 인스턴스가 S3 API를 호출하려면 기본적으로 이렇게 통신해야 한다.

```
EC2(프라이빗) → NAT 게이트웨이 → 라우터 → 인터넷 게이트웨이 → 외부 인터넷 → S3
```

이 경로에서는 S3와의 통신이 인터넷으로 노출되고, NAT 게이트웨이와 데이터 전송 비용도 함께 발생한다.

---

## 3. NAT 게이트웨이와 인터넷 게이트웨이 정리

### 3-1. 인터넷 게이트웨이(IGW)

- VPC를 인터넷과 연결해주는 관문 역할
- 퍼블릭 서브넷의 라우팅 테이블에 `0.0.0.0/0 → 인터넷 게이트웨이`를 추가하면, 해당 서브넷의 인스턴스들이 인터넷으로 나갈 수 있다.
- 자체 요금은 없지만, 인터넷으로 나가는 데이터 전송 요금은 발생한다.

### 3-2. NAT 게이트웨이

프라이빗 서브넷의 인스턴스가 **직접 공인 IP를 갖지 않고** 인터넷으로 나가야 할 때 사용하는 게 NAT 게이트웨이다.

- NAT 게이트웨이는 퍼블릭 서브넷에 위치하고, 공인 IP를 가진다.
- 프라이빗 서브넷의 라우팅 테이블에 `0.0.0.0/0 → NAT 게이트웨이`를 추가하면,
  프라이빗 인스턴스가 인터넷으로 나갈 때 출발지 IP가 NAT 게이트웨이의 공인 IP로 변환된다.
- 외부에서 NAT 게이트웨이를 통해 프라이빗 인스턴스로 **들어오는(inbound) 것은 불가능**하다.
  이 때문에 보안상 유리하다는 장점이 있다.

요약하면, NAT 게이트웨이는 프라이빗 서브넷의 "대리 기사" 역할을 한다고 보면 된다.

```
EC2(10.0.1.10) → NAT GW(54.xxx.xxx.xxx)로 변환 → 인터넷 → 응답 → NAT GW → EC2
```

### 3-3. NAT 게이트웨이의 비용 구조

NAT 게이트웨이는 편리하지만 가격이 만만하지 않다.

- 시간당 요금: 약 **$0.045/시간**
- 처리 데이터 요금: 약 **$0.045/GB**
- 여기에 일반 인터넷 아웃바운드 데이터 전송료(예: $0.09/GB 수준)까지 더해진다.

월 1TB 수준만 되어도 NAT만으로 100달러 이상, 고가용성 구성(여러 AZ)에선 300~500달러를 금방 넘길 수 있다.

---

## 4. 왜 VPC 엔드포인트가 필요한가?

프라이빗 서브넷의 EC2가 S3나 DynamoDB, CloudWatch 같은 AWS 서비스에 접근할 때,
굳이 인터넷을 돌지 않고 **AWS 내부 네트워크에서만 통신**할 수 있으면 보안·비용·성능 측면에서 모두 유리하다.

문제는 S3, DynamoDB가 내 VPC가 아니라 "AWS 공용 영역"에 있다는 점이다.
이 간극을 메워주는 서비스가 바로 **VPC 엔드포인트(VPC Endpoint)**다.

VPC 엔드포인트를 사용하면 통신 경로는 이렇게 바뀐다.

```
EC2(프라이빗) → VPC 엔드포인트 → AWS 내부 네트워크 → S3
```

여기서 중요한 포인트는:

- **인터넷 게이트웨이, NAT 게이트웨이를 거치지 않는다.**
- 통신은 AWS 백본 네트워크 안에서만 이루어진다.
- 트래픽이 인터넷에 노출되지 않기 때문에 보안성이 올라가고,
  NAT 게이트웨이 비용과 인터넷 데이터 전송 비용을 크게 줄일 수 있다.

---

## 5. VPC 엔드포인트의 두 가지 종류

VPC 엔드포인트는 크게 두 종류로 나뉜다.

1. **게이트웨이 엔드포인트(Gateway Endpoint)**
2. **인터페이스 엔드포인트(Interface Endpoint, AWS PrivateLink)**

각각 접근 방식과 지원 서비스가 다르기 때문에, 상황에 따라 적절한 것을 골라야 한다.

### 5-1. 게이트웨이 엔드포인트

게이트웨이 엔드포인트는 **라우팅 테이블 기반**으로 동작한다.

- 대상 서비스: **S3, DynamoDB** 두 가지 서비스만 지원
- 동작 방식:
    - 특정 서비스(S3 등)를 선택해 게이트웨이 엔드포인트를 생성한다.
    - 선택한 라우팅 테이블에 자동으로 `목적지 → 엔드포인트` 규칙이 추가된다.
    - 이때 목적지는 AWS가 제공하는 **프리픽스 리스트(Prefix List)**를 사용한다.
- 보안 그룹이 필요 없고, VPC 단위로 사용 가능하다.

**프라이빗 EC2 → 라우팅 테이블 → 게이트웨이 엔드포인트 → S3** 흐름으로 이해하면 된다.

### 5-2. 인터페이스 엔드포인트

인터페이스 엔드포인트는 **ENI(Elastic Network Interface)를 하나 생성해서 서비스와 연결하는 방식**이다.

- 대상 서비스: SQS, SNS, Kinesis, CloudWatch, Secrets Manager 등 대부분의 AWS 서비스
- 동작 방식:
    - 특정 서브넷(일반적으로 프라이빗 서브넷)을 지정하면, 그 서브넷 안에 엔드포인트용 ENI가 만들어진다.
    - 이 ENI에 프라이빗 IP가 할당되고, 이 IP가 해당 서비스로 가는 "문" 역할을 한다.
    - 보안 그룹을 붙여서 이 ENI로 들어오는 트래픽을 제어할 수 있다.
- DNS를 통해 `sns.amazonaws.com` 같은 기존 서비스 도메인이 엔드포인트의 프라이빗 IP로 해석되도록 설정할 수 있다.

즉, 인터페이스 엔드포인트는 **"서비스 전용 ENI를 서브넷 안에 하나 꽂는다"** 라고 생각하면 이해하기 쉽다.

---

## 6. 정리 – 1편에서 다룬 내용

1편에서는 다음 내용을 다뤘다.

- VPC와 ENI의 기본 개념
- S3, CloudWatch 같은 서비스가 VPC 밖에 있다는 점
- NAT 게이트웨이와 인터넷 게이트웨이의 역할과 비용 구조
- 왜 VPC 엔드포인트가 필요한지 (보안·비용·성능 관점)
- VPC 엔드포인트의 두 가지 유형(게이트웨이/인터페이스) 개략

**2편에서는** 여기서 이어서:

- 게이트웨이 엔드포인트의 라우팅/Prefix List 구조
- 인터페이스 엔드포인트의 DNS·PrivateLink 구조
- S3를 예시로 한 실전 구축 단계
- 엔드포인트 정책, S3 버킷 정책으로 VPC 내부에서만 접근 허용하기
- NAT 게이트웨이 vs VPC 엔드포인트 비용 비교와 모범 아키텍처

를 보다 구체적으로 정리해보겠다.

---